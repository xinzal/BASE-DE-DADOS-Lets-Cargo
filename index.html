<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lets Cargo - Atualiza√ß√£o de Pedidos</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f6f8;
        margin: 0;
        padding: 20px;
    }
    h1 {
        text-align: center;
        color: #003c8f;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
    }
    th {
        background-color: #003c8f;
        color: white;
    }
    tr:hover {
        background-color: #f1f1f1;
    }
    input[type="number"] {
        width: 80px;
        padding: 5px;
    }
    button {
        background-color: #003c8f;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    button:hover {
        background-color: #0051c7;
    }
    #container {
        max-width: 1200px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 2px 10px rgba(0,0,0,0.1);
    }
</style>
</head>
<body>

<div id="container">
    <h1>üì¶ Lets Cargo - Atualizar Pedidos</h1>

    <table id="tabelaPedidos">
        <thead>
            <tr>
                <th>N√∫mero do Pedido</th>
                <th>F√°brica</th>
                <th>C√≥digo</th>
                <th>Descri√ß√£o</th>
                <th>Quantidade</th>
                <th>Data do Pedido</th>
                <th>Pallets</th>
                <th>Peso</th>
                <th>Estoque</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody id="corpoTabela"></tbody>
    </table>

    <div style="text-align:center; margin-top: 20px;">
        <button onclick="enviarDados()">Enviar Atualiza√ß√µes</button>
    </div>
</div>

<script>
// URL do seu Web Apps:
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzJOmABpg-yBT3pTYvTY4K9HdHiA2g7yyVC5FbvopPjgUfdudUkpCmzmhybL7MeomjrqQ/exec";

// ====== Carrega pedidos ======
async function carregarPedidos() {
    try {
        const response = await fetch(WEB_APP_URL + "?action=get");
        const pedidos = await response.json();
        const tbody = document.getElementById("corpoTabela");
        tbody.innerHTML = "";

        pedidos.forEach(p => {
            const linha = document.createElement("tr");

            linha.innerHTML = `
                <td>${p.numero}</td>
                <td>${p.fabrica}</td>
                <td>${p.codigo}</td>
                <td>${p.descricao}</td>
                <td>${p.quantidade}</td>
                <td>${p.dataPedido}</td>
                <td><input type="number" class="pallets" placeholder="Qtd" value="${p.pallets || ''}"></td>
                <td><input type="number" class="peso" placeholder="Kg" value="${p.peso || ''}"></td>
                <td><input type="number" class="estoque" placeholder="Qtd" value="${p.estoque || ''}"></td>
                <td><button onclick="enviarLinha(this)">Atualizar</button></td>
            `;

            tbody.appendChild(linha);
        });

    } catch (err) {
        alert("Erro ao carregar pedidos: " + err.message);
    }
}

// ====== Envia apenas uma linha ======
async function enviarLinha(botao) {
    const linha = botao.closest("tr");
    const numero = linha.cells[0].innerText;
    const fabrica = linha.cells[1].innerText;
    const codigo = linha.cells[2].innerText;
    const descricao = linha.cells[3].innerText;
    const quantidade = linha.cells[4].innerText;
    const pallets = linha.querySelector(".pallets").value;
    const peso = linha.querySelector(".peso").value;
    const estoque = linha.querySelector(".estoque").value;

    const dados = {
        numero,
        fabrica,
        itens: [
            { codigo, descricao, quantidade, pallets, peso, estoque }
        ]
    };

    try {
        const response = await fetch(WEB_APP_URL, {
            method: "POST",
            body: JSON.stringify(dados),
            headers: { "Content-Type": "application/json" }
        });

        const result = await response.json();

        if (result.status === "success") {
            linha.style.backgroundColor = "#d9ead3"; // üü© verde claro
            linha.style.transition = "background-color 0.5s ease";
        } else {
            alert("Erro ao atualizar: " + result.message);
        }
    } catch (err) {
        alert("Erro de conex√£o: " + err.message);
    }
}

// ====== Envia todos os pedidos ======
async function enviarDados() {
    const linhas = document.querySelectorAll("#tabelaPedidos tbody tr");

    for (let linha of linhas) {
        await enviarLinha(linha.querySelector("button"));
    }

    alert("Todas as atualiza√ß√µes foram enviadas!");
}

carregarPedidos();
</script>

</body>
</html>
