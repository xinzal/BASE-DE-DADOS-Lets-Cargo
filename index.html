<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lets Cargo - Visualizar Pedidos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f6f8;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #003c8f;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background-color: #fff;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
  }
  th {
    background-color: #003c8f;
    color: white;
  }
  tr:hover {
    background-color: #f1f1f1;
  }
  button {
    background-color: #003c8f;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover {
    background-color: #0051c7;
  }
  .linha-verde {
    background-color: #c8e6c9 !important;
    transition: background-color 0.5s ease;
  }
  input {
    width: 80px;
    padding: 4px;
    box-sizing: border-box;
  }
</style>
</head>
<body>

<h1>üì¶ Lets Cargo - Visualizar Pedidos</h1>

<table id="tabelaPedidos">
  <thead>
    <tr>
      <th>N√∫mero do Pedido</th>
      <th>F√°brica</th>
      <th>C√≥digo do Item</th>
      <th>Descri√ß√£o</th>
      <th>Quantidade</th>
      <th>Pallets</th>
      <th>Peso Separa√ß√£o</th>
      <th>Qtd em Estoque</th>
      <th>A√ß√µes</th>
    </tr>
  </thead>
  <tbody id="corpoTabela">
    <tr><td colspan="9">Carregando...</td></tr>
  </tbody>
</table>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwXTRiT7-QJjqFvylgDF4-AGRObNBowp5_IXDaytnaM8WFVMS4NfYuBTn2MtL0xHLMAvQ/exec";

// ===== CARREGA PEDIDOS =====
async function carregarPedidos() {
  try {
    const res = await fetch(WEB_APP_URL + "?action=get");
    const pedidos = await res.json();
    const tbody = document.getElementById("corpoTabela");
    tbody.innerHTML = "";

    pedidos.forEach(p => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.numero}</td>
        <td>${p.fabrica}</td>
        <td>${p.codigo}</td>
        <td>${p.descricao}</td>
        <td>${p.quantidade}</td>
        <td><input type="number" value="${p.pallets || ''}" placeholder="Pallets"></td>
        <td><input type="number" value="${p.peso || ''}" placeholder="Peso"></td>
        <td><input type="number" value="${p.estoque || ''}" placeholder="Estoque"></td>
        <td><button onclick="enviarDados(this)">Enviar</button></td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    document.getElementById("corpoTabela").innerHTML = `<tr><td colspan="9">Erro ao carregar pedidos</td></tr>`;
    console.error(err);
  }
}

// ===== ENVIA DADOS =====
async function enviarDados(botao) {
  const linha = botao.closest("tr");
  const numero = linha.children[0].innerText;
  const fabrica = linha.children[1].innerText;
  const codigo = linha.children[2].innerText;
  const descricao = linha.children[3].innerText;
  const quantidade = linha.children[4].innerText;
  const pallets = linha.children[5].querySelector("input").value;
  const peso = linha.children[6].querySelector("input").value;
  const estoque = linha.children[7].querySelector("input").value;

  const dados = {
    numero,
    fabrica,
    itens: [{
      codigo,
      descricao,
      quantidade,
      pallets,
      peso,
      estoque
    }]
  };

  try {
    const response = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify(dados),
      headers: { "Content-Type": "application/json" }
    });

    const result = await response.json();

    if (result.status === "success") {
      // ‚úÖ Muda a linha para verde somente ap√≥s atualiza√ß√£o na planilha
      linha.classList.add("linha-verde");
    } else {
      alert("Erro ao enviar dados: " + result.message);
    }
  } catch (err) {
    alert("Erro de conex√£o: " + err.message);
  }
}

// Carrega pedidos ao abrir a p√°gina
carregarPedidos();
</script>

</body>
</html>
